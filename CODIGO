#Codigo final para un sistema de inventario de productos usando SQLite

import sqlite3

# Conexi√≥n a la base de datos
con = sqlite3.connect("productos.db")
cur = con.cursor()

#cur es tu cursor de SQLite, el objeto que ejecuta las consultas SQL.


# Crear tabla si no existe
cur.execute("""
CREATE TABLE IF NOT EXISTS inventario_productos1 (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nombre TEXT NOT NULL,
    precio REAL NOT NULL,
    categoria TEXT NOT NULL,
    cantidad INTEGER NOT NULL
)
""")
con.commit()

# ================== FUNCIONES ==================

#def mostrar_producto(prod)
    

def agregar_producto():
    print("\n--- Alta de producto ---\n")
    nombre = input("Nombre: ").strip()
    precio = input("Precio: ").strip()
    categoria = input("Categor√≠a: ").strip()
    cantidad = input("Cantidad: ").strip()

    if not nombre or not precio or not categoria or not cantidad:
        print("‚ùå Error: ning√∫n campo puede estar vac√≠o.")
        return

    try:
        precio = int(precio)
        cantidad = int(cantidad)
        cur.execute("INSERT INTO inventario_productos1 (nombre, precio, categoria, cantidad) VALUES (?,?,?,?)",
                (nombre, precio, categoria, cantidad))
        con.commit()
        print("‚úÖ Producto agregado correctamente.")

    except ValueError:
        print("‚ùå Precio debe ser n√∫mero y cantidad debe ser entero.")



def listar_productos():

    print("\n--- Listado de productos ---\n")

    res = cur.execute("SELECT * FROM inventario_productos1")
    productos = res.fetchall()

    if not productos:
        print("No hay productos registrados.")
        return
    for p in productos:
        print(f"ID: {p[0]} | Nombre: {p[1]} | Precio: ${p[2]} | Categor√≠a: {p[3]} | Cantidad: {p[4]}")

def actualizar_stock():
    print("\n--- Actualizar stock ---\n")

    listar_productos()
    try:
        pid = int(input("Ingrese el ID del producto: "))
        nueva_cantidad = int(input("Nueva cantidad: "))
        cur.execute("UPDATE inventario_productos1 SET cantidad = ? WHERE id = ?", (nueva_cantidad, pid))
        con.commit()
        if cur.rowcount == 0:                                  #rowcount es un atributo del cursor que indica cu√°ntas filas fueron afectadas por la √∫ltima operaci√≥n SQL (INSERT, UPDATE, DELETE).
            print("‚ùå No se encontr√≥ producto con ese ID.")
        else:
            print("‚úÖ Stock actualizado correctamente.")
    except ValueError:
        print("‚ùå ID y cantidad deben ser n√∫meros enteros.")


def buscar_producto():
    print("\n--- Buscar producto (por ID) ---\n")
    try:
        pid = int(input("Ingrese el ID del producto a buscar: "))
        cur.execute("SELECT id, nombre, precio, categoria, cantidad FROM inventario_productos1 WHERE id = ?", (pid,))
        p = cur.fetchone()
        
        if p is None:
            print("‚ùå No se encontr√≥ producto con ese ID.")
            return
        
        # Mostrar el producto encontrado
        prod_id, nombre, precio, categoria, cantidad = p
        print(f"‚úÖ Encontrado ID: {prod_id} | Nombre: {nombre} | Precio: ${precio} | Categor√≠a: {categoria} | Cantidad: {cantidad}")
        
    except ValueError:
        print("‚ùå El ID debe ser un n√∫mero entero.")


def eliminar_producto():
    print("\n--- Eliminar producto ---\n")
    listar_productos()
    try:
        pid = int(input("Ingrese el ID a eliminar: "))
        cur.execute("DELETE FROM inventario_productos1 WHERE id = ?", (pid,))
        con.commit()
        if cur.rowcount == 0:
            print("‚ùå No se encontr√≥ producto con ese ID.")
        else:
            print("‚úÖ Producto eliminado correctamente.")
    except ValueError:
        print("‚ùå El ID debe ser un n√∫mero entero.")

def reporte_bajo_stock():
    print("\n--- Reporte de bajo stock ---\n")
    try:
        limite = int(input("Ingrese el l√≠mite de stock: "))
        res = cur.execute("SELECT * FROM inventario_productos1 WHERE cantidad <= ?", (limite,))
        productos = res.fetchall()
        if not productos:
            print("No hay productos con stock bajo.")
            return
        for p in productos:
            print(f"ID: {p[0]} | Nombre: {p[1]} | Stock: {p[4]} unidades")
    except ValueError:
        print("‚ùå El l√≠mite debe ser un n√∫mero entero.")

# ================== MEN√ö ==================

def menu():
    opcion = ""
    while opcion != "7":
        print("\n" + "="*45)
        print("\n=== Sistema de Inventario ===")
        print("\n" + "="*45)
        print("1. Agregar producto")
        print("2. Listar productos")
        print("3. Actualizar stock")
        print("4. Buscar producto")
        print("5. Eliminar producto")
        print("6. Reporte bajo stock")
        print("7. Salir")
        print("\n" + "="*45)

        opcion = input("Seleccione opci√≥n: ").strip()

        if opcion == "1":
            agregar_producto()
        elif opcion == "2":
            listar_productos()
        elif opcion == "3":
            actualizar_stock()
        elif opcion == "4":
            buscar_producto()
        elif opcion == "5":
            eliminar_producto()
        elif opcion == "6":
            reporte_bajo_stock()
        elif opcion == "7":
            print("\nüëã Cerrando el sistema. ¬°Hasta pronto!")  

# ================== EJECUCI√ìN ==================
if __name__ == "__main__":
    menu()
